<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>HG ACÄ°L</title>
<style>
body{font-family:sans-serif;padding:18px;margin:0;background:#fff;color:#111;text-align:center}
#panicBtn{width:100%;padding:22px;font-size:21px;background:#d33;color:#fff;border:none;border-radius:12px;font-weight:600;cursor:pointer;margin-top:14px}
.menuBtn{padding:12px;font-size:15px;border-radius:8px;background:#222;color:#fff;border:none;cursor:pointer;flex:1}
.contactBtn{width:100%;padding:16px;font-size:17px;background:#222;color:#fff;border:none;border-radius:10px;margin-top:10px;font-weight:600;cursor:pointer}
#logBox{background:#000;color:#fff;font-size:13px;padding:12px;border-radius:8px;margin-top:14px;min-height:40px;white-space:pre-wrap;text-align:left}
.panel{display:none;background:#eee;padding:14px;border-radius:8px;margin-top:14px;text-align:left;font-size:14px;width:100%}
.warn{background:#ffefc2;padding:10px;border-left:4px solid #e6a700;border-radius:6px;margin-top:12px;font-size:13px;color:#b00}
input{width:100%;padding:10px;font-size:15px;border-radius:6px;border:1px solid #444;margin-top:4px}
</style>
</head>
<body>

<h2>HG Acil Durum</h2>

<div class="topbar" style="display:flex;gap:8px;margin-bottom:12px">
  <button id="btnSettings" class="menuBtn">âš™ Ayarlar</button>
  <button id="btnPerms" class="menuBtn">ğŸ“Œ Ä°zinler</button>
</div>

<button id="panicBtn">ACÄ°L</button>

<div id="contacts"></div>

<h3>Durum Log</h3>
<div id="logBox">Sistem bekliyorâ€¦</div>

<div id="warnings"></div>

<!-- Ä°ZÄ°N PANEL -->
<div id="permPanel" class="panel">
  <h3>Ä°zinler</h3>
  <button id="permGPS" class="alt menuBtn">ğŸ“ Konum</button>
  <button id="permNotif" class="alt menuBtn">ğŸ”” Bildirim</button>
  <button id="permMotion" class="alt menuBtn">ğŸ“± Ä°vme/Hareket</button>
  <button id="permBT" class="alt menuBtn">âŒš Bluetooth</button>
  <button id="permSMS" class="alt menuBtn">âœ‰ SMS</button>
  <button id="permClose" class="alt">Kapat</button>
  <div id="permResult" class="warn"></div>
</div>

<!-- AYARLAR PANEL -->
<div id="settingsPanel" class="panel">
  <h3>Ayarlar</h3>
  <div id="settingsProfile" class="warn"></div>
  <div id="settingsPerms" class="warn"></div>
  <button id="settingsEdit" class="alt">Profili DÃ¼zenle</button>
  <button id="settingsClose" class="alt">Kapat</button>
</div>

<!-- PROFÄ°L PANEL -->
<div id="profilePanel" class="panel">
  <h3>Profil</h3>
  <label>Ad Soyad</label>
  <input id="ad"/>
  <label>Acil KiÅŸi 1</label>
  <input id="acil1ad"/>
  <input id="acil1tel"/>
  <label>Acil KiÅŸi 2</label>
  <input id="acil2ad"/>
  <input id="acil2tel"/>
  <button id="profileSave">Kaydet & BaÅŸlat</button>
  <button id="profileClose" class="alt">Kapat</button>
</div>

<!-- CONFIRM PANEL -->
<div id="confirmPanel" class="panel">
  <h3>112 Aramaya HazÄ±r</h3>
  <button id="call112">112'yi Ara</button>
  <button id="cancel112" class="alt">Ä°ptal</button>
</div>

<script>
const LS = localStorage;

// Panel kontrollerini baÄŸla
btnPerms.onclick = () => permPanel.style.display="block";
permClose.onclick = () => permPanel.style.display="none";
btnSettings.onclick = () => {settingsPanel.style.display="block";refreshSettings();};
settingsClose.onclick = () => settingsPanel.style.display="none";
settingsEdit.onclick = () => profilePanel.style.display="block";
settingsEdit.style.cursor="pointer";
btnPerms.style.cursor="pointer";
btnSettings.style.cursor="pointer";

// Profil kaydet
profileSave.onclick = () => {
  const p={
    ad:ad.value,
    acil1:{ad:acil1ad.value,tel:acil1tel.value},
    acil2:acil2ad.value&&acil2tel.value?{ad:acil2ad.value,tel:acil2tel.value}:null
  };
  LS.setItem("profile",JSON.stringify(p));
  permPanel.style.display="none";
  profilePanel.style.display="none";
  bindContacts();
  alert("Kaydedildi âœ”");
};

// Profil kapat
profileClose.onclick = ()=>profilePanel.style.display="none";
profileClose.style.cursor="pointer";

// Acil kiÅŸiler butonlarÄ±nÄ± baÄŸla
function bindContacts(){
  const p=JSON.parse(LS.getItem("profile")||"null");
  if(!p) return;
  emergencyContacts.innerHTML =
    `<button class="contactBtn" onclick="callAcil(1)">Acil 1: ${p.acil1.ad}</button>`+
    (p.acil2?`<button class="contactBtn" onclick="callAcil(2)">Acil 2: ${p.acil2.ad}</button>`:"");
}

// Ayarlar refresh
function refreshSettings(){
  const p=JSON.parse(LS.getItem("profile")||"{}");
  const perms=JSON.parse(LS.getItem("izinler")||"{}");
  settingsProfile.innerText = p.ad?`KullanÄ±cÄ±: ${p.ad}\nAcil 1: ${p.acil1?.ad} (${p.acil1?.tel})\nAcil 2: ${p.acil2?.ad||"â€”"}`:"Profil yok";
  settingsPerms.innerText = `Konum: ${perms.gps?"AÃ§Ä±k":"KapalÄ±"} | Bildirim: ${perms.notif?"AÃ§Ä±k":"KapalÄ±"} | Ä°vme: ${perms.motion?"AÃ§Ä±k":"KapalÄ±"} | Bluetooth: ${perms.bt?"AÃ§Ä±k":"KapalÄ±"} | SMS: ${perms.sms?"AÃ§Ä±k":"KapalÄ±"}`;
}

// Acil Ã§aÄŸrÄ±
window.callAcil = async function(n){
  const p=JSON.parse(LS.getItem("profile"));
  const c=n===1?p.acil1:p.acil2;
  if(!c?.tel) return alert("Acil kiÅŸi yok âŒ");
  location.href="tel:"+c.tel;
  navigator.geolocation?.getCurrentPosition(pos=>{
    const loc="https://maps.google.com/?q="+pos.coords.latitude+","+pos.coords.longitude;
    const msg=`ğŸš¨ ACÄ°L | ${p.ad}\nKonum: ${loc}`;
    location.href="sms:"+c.tel+"?body="+encodeURIComponent(msg);
    navigator.share?.({title:"Acil",text:msg});
    document.getElementById("logBox").innerText="ğŸ“¤ "+c.ad+" bilgilendirildi âœ”";
  });
}

// 112 akÄ±ÅŸÄ±
panicBtn.onclick = ()=>confirmPanel.style.display="block";
call112.onclick = ()=>location.href="tel:112";
cancel112.onclick = ()=>confirmPanel.style.display="none";

bindContacts();
</script>

</body>
</html>
