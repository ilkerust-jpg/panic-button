<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>HG ACÄ°L</title>

<style>
body{font-family:system-ui,sans-serif;padding:18px;margin:0;background:#fff;color:#111;text-align:center}
.topbar{display:flex;gap:8px;margin-bottom:12px}
.topbar button{flex:1;padding:12px;font-size:15px;border-radius:8px;border:none;background:#222;color:#fff}
button{width:100%;padding:22px;font-size:21px;font-weight:700;border:none;border-radius:14px;margin-top:14px;cursor:pointer}
#panicBtn{background:#d32f2f;color:#fff}
#acilBtn{background:#222;color:#fff}
.panel{display:none;background:#f0f0f0;padding:14px;border-radius:10px;margin-top:14px;text-align:left}
input{width:100%;padding:10px;font-size:15px;border-radius:6px;border:1px solid #444;margin-top:6px}
.warn{background:#ffefc2;padding:10px;border-left:4px solid #e6a700;border-radius:6px;margin-top:10px;font-size:13px}
#logBox{background:#000;color:#0f0;font-size:13px;padding:10px;border-radius:8px;margin-top:14px;text-align:left;min-height:40px}
</style>
</head>

<body>

<h2>Acil Durum</h2>

<div class="topbar">
  <button id="btnSettings">âš™ Ayarlar</button>
</div>

<button id="panicBtn">ðŸš¨ ACÄ°L (112)</button>
<button id="acilBtn">ðŸ‘¤ ACÄ°L KÄ°ÅžÄ°</button>

<div id="logBox">HazÄ±r</div>

<!-- AYARLAR -->
<div id="settingsPanel" class="panel">
  <h3>Profil</h3>
  <input id="p_name" placeholder="Ad Soyad">
  <input id="p_emName" placeholder="Acil KiÅŸi Ä°sim (opsiyonel)">
  <input id="p_emTel" placeholder="Acil KiÅŸi Telefon">
  <button id="saveProfile">Kaydet</button>
  <div id="settingsInfo" class="warn"></div>
  <button onclick="settingsPanel.style.display='none'">Kapat</button>
</div>

<script>
/* === TEK VE NET STORAGE === */
const STORAGE_KEY = "PANIC_PROFILE_V1";

/* === UTILS === */
function log(m){ logBox.innerText = m; }

/* === PROFÄ°L OKU === */
function getProfile(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(!raw) return null;
  try{ return JSON.parse(raw); }catch{ return null; }
}

/* === PROFÄ°L YÃœKLE === */
function loadProfile(){
  const p = getProfile();
  if(!p){
    log("Profil yok");
    return;
  }
  p_name.value   = p.name   || "";
  p_emName.value = p.emName || "";
  p_emTel.value  = p.emTel  || "";
  log("Profil yÃ¼klÃ¼: " + p.emTel);
}

/* === PROFÄ°L KAYDET === */
saveProfile.onclick = ()=>{
  const name = p_name.value.trim();
  const tel  = p_emTel.value.trim();

  if(!name || !tel){
    alert("Ad Soyad ve Acil Telefon zorunlu");
    return;
  }

  const profile = {
    name: name,
    emName: p_emName.value.trim(),
    emTel: tel
  };

  localStorage.setItem(STORAGE_KEY, JSON.stringify(profile));
  log("Kaydedildi: " + tel);
};

/* === AYARLAR === */
btnSettings.onclick = ()=>{
  settingsPanel.style.display = "block";
  loadProfile();
};

/* === ACÄ°L 112 === */
panicBtn.onclick = ()=>{
  log("112 aranÄ±yor");
  location.href = "tel:112";
};

/* === ACÄ°L KÄ°ÅžÄ° === */
acilBtn.onclick = ()=>{
  const p = getProfile();

  if(!p || !p.emTel){
    log("HATA: Acil kiÅŸi tanÄ±mlÄ± deÄŸil");
    alert("Acil kiÅŸi tanÄ±mlÄ± deÄŸil");
    return;
  }

  log("AranÄ±yor: " + p.emTel);
  location.href = "tel:" + p.emTel;

  navigator.geolocation.getCurrentPosition(pos=>{
    const map = `https://maps.google.com/?q=${pos.coords.latitude},${pos.coords.longitude}`;
    const time = new Date().toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit"});
    const msg =
      `${p.name} â€“ ACÄ°L DURUM\n` +
      `Konum: ${map}\n` +
      `Saat: ${time}`;

    location.href = "sms:" + p.emTel + "?body=" + encodeURIComponent(msg);
  });
};

/* === INIT === */
loadProfile();
</script>

</body>
</html>
