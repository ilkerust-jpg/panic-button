<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>HG ACÄ°L</title>
<style>
  body{font-family:sans-serif;padding:16px;margin:0;background:#fff;color:#111}
  input{width:100%;padding:10px;font-size:15px;border-radius:6px;border:1px solid #444;margin-top:4px}
  button{width:100%;padding:14px;font-size:16px;background:#c00;color:#fff;border:none;border-radius:8px;margin-top:10px;cursor:pointer;font-weight:600}
  button.alt{background:#222;color:#fff}
  #panicBtn{font-size:20px;padding:22px;border-radius:10px;font-weight:700;background:#d00}
  #logBox{background:#111;color:#fff;font-size:13px;padding:10px;border-radius:6px;min-height:70px;white-space:pre-wrap;margin-top:12px}
  .topbar{display:flex;gap:8px;margin-bottom:12px}
  .topbar button{padding:10px;font-size:14px;border-radius:6px;margin:0;background:#222;color:#fff;width:auto;flex:1}
  .warn{background:#ffefc2;padding:8px;border-radius:6px;font-size:13px;margin-top:8px;border-left:3px solid #e6a700}
  #settingsPanel,#permPanel,#profilePanel,#confirmPanel{display:none;padding:12px;background:#f5f5f5;border-radius:8px;margin-top:12px}
  #confirmPanel button{background:#222;color:#fff;font-size:15px;padding:14px}
</style>
</head>
<body>

<h2>Acil Durum Ä°zleme</h2>

<div class="topbar">
  <button onclick="openSettings()">Ayarlar</button>
  <button onclick="togglePerms()">Ä°zinler</button>
</div>

<button id="panicBtn" onclick="panicStep()">ACÄ°L</button>

<div id="acilButtons"></div>

<div><strong>CanlÄ± Log</strong><div id="logBox">Sistem bekliyorâ€¦</div></div>

<div id="settingsPanel">
  <h3>Ayarlar</h3>
  <div id="settingsProfile" class="warn"></div>
  <div id="settingsPerms" class="warn"></div>
  <button class="alt" onclick="editProfile()">Profili DÃ¼zenle</button>
  <button class="alt" onclick="closeSettings()">Kapat</button>
</div>

<div id="permPanel">
  <h3>Ä°zinler</h3>
  <button onclick="requestGPS()">Konum Ä°zni</button>
  <button onclick="requestMotion()">Ä°vme SensÃ¶rÃ¼ Ä°zni</button>
  <button onclick="requestNotif()">Bildirim Ä°zni</button>
  <button onclick="requestBT()">Bluetooth Ä°zni</button>
  <div id="permResult" class="warn"></div>
</div>

<div id="profilePanel">
  <h3>Profil</h3>
  <input id="ad" placeholder="Ad Soyad">
  <input id="acil1ad" placeholder="Acil KiÅŸi 1 Ä°sim">
  <input id="acil1tel" placeholder="Acil KiÅŸi 1 Telefon">
  <input id="acil2ad" placeholder="Acil KiÅŸi 2 Ä°sim (opsiyon)">
  <input id="acil2tel" placeholder="Acil KiÅŸi 2 Telefon (opsiyon)">
  <button onclick="saveProfile()">Kaydet & BaÅŸlat</button>
</div>

<div id="confirmPanel">
  <h3>Acil Onay</h3>
  <button onclick="call112()">112â€™yi Ara</button>
  <button onclick="callEmergency(1)" id="c1"></button>
  <button onclick="callEmergency(2)" id="c2"></button>
  <button onclick="cancelEmergency()">Ä°ptal</button>
</div>

<script>
const LS = localStorage;

function warn(msg){ document.getElementById("permResult").innerHTML += `<div>${msg}</div>`; }
function togglePerms(){ const p=document.getElementById("permPanel"); p.style.display=p.style.display==="block"?"none":"block"; }
function openSettings(){
  const p=JSON.parse(LS.getItem("profile")||"{}");
  const perms=JSON.parse(LS.getItem("izinler")||"{}");
  document.getElementById("settingsProfile").innerText = p.ad ? `KullanÄ±cÄ±: ${p.ad}\nAcil 1: ${p.acil1?.ad} (${p.acil1?.tel})\nAcil 2: ${p.acil2?.ad||"â€”"}` : "Profil yok";
  document.getElementById("settingsPerms").innerText = `Konum: ${perms.konum?"AÃ§Ä±k":"KapalÄ±"}\nÄ°vme: ${perms.motion?"AÃ§Ä±k":"KapalÄ±"}\nBildirim: ${perms.notif?"AÃ§Ä±k":"KapalÄ±"}\nBluetooth: ${perms.bt?"AÃ§Ä±k":"KapalÄ±"}`;
  document.getElementById("settingsPanel").style.display="block";
}
function closeSettings(){ document.getElementById("settingsPanel").style.display="none"; }
function panicStep(){
  const p=JSON.parse(LS.getItem("profile")||"{}");
  if(!p.ad){ show("permPanel"); alert("Ã–nce profil kaydet!"); return; }
  document.getElementById("c1").innerText = p.acil1?.ad || "Acil 1 yok";
  document.getElementById("c2").innerText = p.acil2?.ad || "";
  show("confirmPanel");
}
function callEmergency(n){
  const p=JSON.parse(LS.getItem("profile"));
  const c = n===1 ? p.acil1 : p.acil2;
  if(!c?.tel) return alert("Telefon yok!");
  navigator.geolocation.getCurrentPosition(pos=>{
    const loc=`${pos.coords.latitude},${pos.coords.longitude}`;
    const msg=`ðŸš¨ ACÄ°L | ${p.ad}\nKonum: ${loc}`;
    location.href=`sms:${c.tel}?body=${encodeURIComponent(msg)}`;
    if(navigator.share) navigator.share({title:"Acil",text:msg});
    document.getElementById("logBox").innerText += `\nðŸ“¤ ${c.ad} bilgilendirildi`;
  }, ()=> alert("Konum alÄ±namadÄ±"));
  location.href="tel:"+c.tel;
}
function call112(){ location.href="tel:112"; }
function cancelEmergency(){ show("mainPanel"); }
function editProfile(){ show("profilePanel"); editProfileFill(); }
function editProfileFill(){
  const p=JSON.parse(LS.getItem("profile")||"{}");
  if(!p.ad) return;
  document.getElementById("ad").value = p.ad;
  document.getElementById("acil1ad").value = p.acil1?.ad;
  document.getElementById("acil1tel").value = p.acil1?.tel;
  document.getElementById("acil2ad").value = p.acil2?.ad||"";
  document.getElementById("acil2tel").value = p.acil2?.tel||"";
}
function saveProfile(){
  const ad=document.getElementById("ad").value.trim();
  const a1=document.getElementById("acil1ad").value.trim();
  const t1=document.getElementById("acil1tel").value.trim();
  const a2=document.getElementById("acil2ad").value.trim();
  const t2=document.getElementById("acil2tel").value.trim();
  if(!ad||!a1||!t1) return alert("Eksik alan!");
  const obj={ad,acil1:{ad:a1,tel:t1},acil2:a2&&t2?{ad:a2,tel:a2}:null};
  LS.setItem("profile",JSON.stringify(obj));
  LS.setItem("izinler",JSON.stringify(izinler));
  bindButtons();
  show("mainPanel");
}
function bindButtons(){
  const p=JSON.parse(LS.getItem("profile")||"{}");
  if(!p.ad) return;
  document.getElementById("acilButtons").innerHTML =
    `<button onclick="callEmergency(1)">Acil 1: ${p.acil1.ad}</button>` +
    (p.acil2?`<button onclick="callEmergency(2)">Acil 2: ${p.acil2.ad}</button>`:"");
}
function show(id){ showPanel(id); }
window.onload = ()=>{ if(LS.getItem("profile")) bindButtons(); show("mainPanel"); }
</script>

</body>
</html>
