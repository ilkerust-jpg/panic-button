<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>HG ACÄ°L</title>

<style>
body{font-family:system-ui,sans-serif;padding:18px;margin:0;background:#fff;color:#111;text-align:center}
.topbar{display:flex;gap:8px;margin-bottom:12px}
.topbar button{flex:1;padding:12px;font-size:15px;border-radius:8px;border:none;background:#222;color:#fff}
button{width:100%;padding:22px;font-size:21px;font-weight:700;border:none;border-radius:14px;margin-top:14px;cursor:pointer}
#panicBtn{background:#d32f2f;color:#fff}
#acilBtn{background:#222;color:#fff}
.panel{display:none;background:#f0f0f0;padding:14px;border-radius:10px;margin-top:14px;text-align:left}
input{width:100%;padding:10px;font-size:15px;border-radius:6px;border:1px solid #444;margin-top:6px}
.warn{background:#ffefc2;padding:10px;border-left:4px solid #e6a700;border-radius:6px;margin-top:10px;font-size:13px}
.status{font-size:13px;margin-top:6px}
#logBox{background:#000;color:#fff;font-size:13px;padding:10px;border-radius:8px;margin-top:14px;text-align:left;min-height:40px}
</style>
</head>

<body>

<h2>Acil Durum</h2>

<div class="topbar">
  <button id="btnSettings">âš™ Ayarlar</button>
  <button id="btnPerms">ğŸ“Œ Ä°zinler</button>
</div>

<button id="panicBtn">ğŸš¨ ACÄ°L</button>
<button id="acilBtn">ğŸ‘¤ ACÄ°L KÄ°ÅÄ°</button>

<div id="logBox">HazÄ±r</div>

<!-- Ä°ZÄ°NLER -->
<div id="permPanel" class="panel">
  <h3>Ä°zinler</h3>

  <button id="permGPS">ğŸ“ Konum</button>
  <div id="gpsStatus" class="status"></div>

  <button id="permNotif">ğŸ”” Bildirim</button>
  <div id="notifStatus" class="status"></div>

  <button id="permClose">Kapat</button>
</div>

<!-- AYARLAR -->
<div id="settingsPanel" class="panel">
  <h3>Ayarlar</h3>
  <div id="settingsInfo" class="warn"></div>
  <button id="editProfile">âœ Profili DÃ¼zenle</button>
  <button id="settingsClose">Kapat</button>
</div>

<!-- PROFÄ°L -->
<div id="profilePanel" class="panel">
  <h3>Profil</h3>
  <input id="name" placeholder="Ad Soyad">
  <input id="emName" placeholder="Acil KiÅŸi Ä°sim">
  <input id="emTel" placeholder="Acil KiÅŸi Telefon">
  <button id="saveProfile">Kaydet</button>
</div>

<script>
const LS = localStorage;
const HOLD = 1200;
let timer=null;

function log(m){ logBox.innerText=m; }
function show(p){ p.style.display="block"; }
function hide(p){ p.style.display="none"; }

function bindHold(btn,fn){
  const start=()=>timer=setTimeout(fn,HOLD);
  const stop=()=>clearTimeout(timer);
  ["mousedown","touchstart"].forEach(e=>btn.addEventListener(e,start));
  ["mouseup","mouseleave","touchend","touchcancel"].forEach(e=>btn.addEventListener(e,stop));
}

/* ==== PERMISSIONS STATE ==== */
function loadPermStatus(){
  gpsStatus.innerText = navigator.geolocation ? "Konum API mevcut" : "Konum API yok";
  notifStatus.innerText = "Bildirim: " + Notification.permission;
}

/* ==== PROFILE ==== */
function loadProfile(){
  const p = JSON.parse(LS.getItem("profile")||"null");
  if(!p) return;
  name.value = p.name;
  emName.value = p.emName;
  emTel.value = p.emTel;
}

saveProfile.onclick=()=>{
  if(!name.value || !emTel.value){
    alert("Eksik bilgi");
    return;
  }
  LS.setItem("profile",JSON.stringify({
    name:name.value,
    emName:emName.value,
    emTel:emTel.value
  }));
  hide(profilePanel);
  log("Profil kaydedildi");
};

/* ==== SETTINGS ==== */
btnSettings.onclick=()=>{
  const p=JSON.parse(LS.getItem("profile")||"{}");
  settingsInfo.innerText = p.name
    ? `${p.name}\nAcil: ${p.emName} (${p.emTel})`
    : "Profil yok";
  show(settingsPanel);
};
settingsClose.onclick=()=>hide(settingsPanel);
editProfile.onclick=()=>show(profilePanel);

/* ==== PERMISSIONS ==== */
btnPerms.onclick=()=>{
  loadPermStatus();
  show(permPanel);
};
permClose.onclick=()=>hide(permPanel);

permGPS.onclick=()=>{
  navigator.geolocation.getCurrentPosition(
    ()=>{ gpsStatus.innerText="Konum izni verildi"; },
    ()=>{ gpsStatus.innerText="Konum reddedildi"; }
  );
};

permNotif.onclick=async()=>{
  if(Notification.permission==="denied"){
    notifStatus.innerText="Bildirim reddedilmiÅŸ (tarayÄ±cÄ± ayarÄ±)";
    return;
  }
  const r = await Notification.requestPermission();
  notifStatus.innerText="Bildirim: "+r;
};

/* ==== ACÄ°L ==== */
bindHold(panicBtn,()=>{
  log("112 aranÄ±yor");
  location.href="tel:112";
});

bindHold(acilBtn,()=>{
  const p = JSON.parse(LS.getItem("profile"));
  if(!p){ alert("Profil yok"); return; }

  location.href="tel:"+p.emTel;

  navigator.geolocation.getCurrentPosition(pos=>{
    const map=`https://maps.google.com/?q=${pos.coords.latitude},${pos.coords.longitude}`;
    const time=new Date().toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit"});
    const msg=`${p.name} â€“ ACÄ°L DURUM\nKonum: ${map}\nSaat: ${time}`;
    location.href="sms:"+p.emTel+"?body="+encodeURIComponent(msg);
    log("Acil kiÅŸi bilgilendirildi");
  });
});

/* INIT */
loadProfile();
loadPermStatus();
</script>

</body>
</html>
