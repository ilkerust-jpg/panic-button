<!DOCTYPE html><html lang="tr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>HG Acil</title><style>
body{font-family:sans-serif;padding:18px;margin:0;background:#fff;color:#111;text-align:center}
button{width:100%;padding:18px;font-size:18px;background:#d33;color:#fff;border:none;border-radius:10px;margin-top:12px;font-weight:600;cursor:pointer}
.topbar{display:flex;gap:8px;margin-bottom:12px}
.topbar button{padding:14px;font-size:15px;border-radius:8px;margin:0;background:#222;color:#fff;width:auto;flex:1}
.panel{display:none;background:#eee;padding:14px;border-radius:8px;margin-top:14px;text-align:left;font-size:14px}
.warn{background:#fff3cd;padding:10px;border-left:4px solid #e6a700;border-radius:6px;margin-top:12px;font-size:13px;color:#b00}
#logBox{background:#000;color:#fff;font-size:13px;padding:12px;border-radius:8px;margin-top:14px;min-height:40px;white-space:pre-wrap;text-align:left}
input{width:100%;padding:10px;font-size:15px;border-radius:6px;border:1px solid #444;margin-top:4px}
.contactBtn{width:100%;padding:16px;font-size:17px;background:#222;color:#fff;border:none;border-radius:10px;margin-top:10px;font-weight:600;cursor:pointer}
</style></head><body>

<h2>HG Acil Durum</h2>

<div class="topbar">
  <button id="btnSettings">âš™ Ayarlar</button>
  <button id="btnPerms">ğŸ“Œ Ä°zinler</button>
</div>

<button id="panicBtn">ğŸš¨ ACÄ°L</button>

<div id="contacts"></div>

<div><strong>CanlÄ± Log</strong><div id="logBox">Sistem bekliyorâ€¦</div></div>

<!-- Ä°zin Panel -->
<div id="permPanel" class="panel">
  <h3>Gerekli Ä°zinler</h3>
  <button id="permGPS">ğŸ“ Konum Ä°zni</button>
  <button id="permNotif" class="alt">ğŸ”” Bildirim Ä°zni</button>
  <button id="permBT" class="alt">âŒš Bluetooth Ä°zni</button>
  <button id="permMotion" class="alt">ğŸ“± Hareket/Ä°vme Ä°zni</button>
  <button id="permClose" class="alt">Kapat</button>
  <div id="permResult"></div>
</div>

<!-- Ayarlar Panel -->
<div id="settingsPanel" class="panel">
  <h3>âš™ Ayarlar</h3>
  <div id="settingsProfile"></div>
  <div id="settingsPerms"></div>
  <button id="settingsClose" class="alt">Kapat</button>
</div>

<!-- Profil Panel -->
<div id="profilePanel" class="panel">
  <h3>Acil Profil</h3>
  <label>Ad Soyad</label>
  <input id="ad"/>
  <label>Acil KiÅŸi 1</label>
  <input id="acil1ad"/>
  <input id="acil1tel"/>
  <label>Acil KiÅŸi 2 (opsiyon)</label>
  <input id="acil2ad"/>
  <input id="acil2tel"/>
  <button id="profileSave">Kaydet & BaÅŸlat</button>
  <button id="profileClose" class="alt">Kapat</button>
</div>

<!-- Confirm Panel -->
<div id="confirmPanel" class="panel">
  <h3>ğŸš¨ Acil Onay</h3>
  <button id="confirm112">112'yi Ara</button>
  <button id="confirm1"></button>
  <button id="confirm2"></button>
  <button id="confirmCancel" class="alt">Ä°ptal</button>
</div>

<script>
const LS = localStorage;

// Panel aÃ§/kapat kontrol
function showPanel(id){ document.getElementById(id).style.display="block"; }
function hidePanel(id){ document.getElementById(id).style.display="none"; }

// Settings panel fonksiyonunu dÃ¼zelt ve baÄŸla
function openSettings(){
  const p = JSON.parse(LS.getItem("profile")||"{}");
  const perms = JSON.parse(LS.getItem("izinler")||"{}");
  document.getElementById("settingsProfile").innerText = p.ad ? `KullanÄ±cÄ±: ${p.ad}\nAcil 1: ${p.acil1?.ad} (${p.acil1?.tel})\nAcil 2: ${p.acil2?.ad||"â€”"}` : "Profil yok";
  document.getElementById("settingsPerms").innerText = `Konum: ${perms.gps?"AÃ§Ä±k":"KapalÄ±"} | Bildirim: ${perms.notif?"AÃ§Ä±k":"KapalÄ±"} | Bluetooth: ${perms.bt?"AÃ§Ä±k":"KapalÄ±"} | Ä°vme: ${perms.motion?"AÃ§Ä±k":"KapalÄ±"}`;
}

// Log alanÄ± max 2 satÄ±r + refresh
let logLines=[];
function updateLogUI(m){
  if(logLines.length>=2) logLines.shift();
  logLines.push(m);
  document.getElementById("logBox").innerText = logLines.join("\n");
  console.log(m);
}

// Acil kiÅŸileri butonlara baÄŸla
function bindEmergencyButtons(){
  const p = JSON.parse(LS.getItem("profile")||"null");
  if(!p) return false;
  let html = `<button class="contactBtn" onclick="acil(1)">Acil 1: ${p.acil1.ad}</button>`;
  if(p.acil2) html += `<button class="contactBtn" onclick="acil(2)">Acil 2: ${p.acil2.ad}</button>`;
  document.getElementById("contacts").innerHTML = html;
  return true;
}

// Ä°zinleri almayÄ± UIâ€™a baÄŸla
document.getElementById("permGPS").onclick = ()=>navigator.geolocation?.getCurrentPosition(p=>{
  izinler.gps=true;
  LS.setItem("izinler",JSON.stringify(izinler));
  document.getElementById("permResult").innerText="ğŸ“ Konum izni alÄ±ndÄ± âœ” Lat:"+p.coords.latitude;
});

document.getElementById("permNotif").onclick = async ()=>{const r=await Notification?.requestPermission(); izinler.notif=r==="granted"; LS.setItem("izinler",JSON.stringify(izinler)); document.getElementById("permResult").innerText="ğŸ”” Bildirim:"+r;}

document.getElementById("permBT").onclick = async ()=>{try{await navigator.bluetooth?.requestDevice({acceptAllDevices:true}); izinler.bt=true; LS.setItem("izinler",JSON.stringify(izinler)); document.getElementById("permResult").innerText="âŒš BT izni âœ”";}catch{document.getElementById("permResult").innerText="BT izni âŒ";}}

document.getElementById("permMotion").onclick = async ()=>{if(!window.DeviceMotionEvent){document.getElementById("permResult").innerText="Ä°vme sensÃ¶rÃ¼ â—";return;} if(typeof DeviceMotionEvent.requestPermission==="function"){const r=await DeviceMotionEvent.requestPermission(); if(r==="granted") izinler.motion=true;} else izinler.motion=true; LS.setItem("izinler",JSON.stringify(izinler)); document.getElementById("permResult").innerText="ğŸ“± Ä°vme izni âœ”";}

// Panel kapat
document.getElementById("permClose").onclick = ()=>hidePanel("permPanel");
document.getElementById("settingsClose").onclick = ()=>hidePanel("settingsPanel");
document.getElementById("settingsClose").onclick = ()=>hidePanel("settingsPanel");

// Profil kaydet
async function saveProfile(){
  const ad=document.getElementById("ad").value.trim();
  const a1=document.getElementByElementById("acil1ad").value.trim();
  const t1=document.getElementById("acil1tel").value.trim();
  const a2=document.getElementById("acil2ad").value.trim();
  const t2=document.getElementById("acil2tel").value.trim();
  if(!ad||!a1||!t1) return alert("Eksik âŒ");
  const obj={ad,acil1:{ad:a1,tel:t1},acil2:a2&&t2?{ad:a2,tel:a2}:null};
  LS.setItem("profile",JSON.stringify(obj));
  LS.setItem("izinler",JSON.stringify(izinler));
  bindEmergencyButtons();
  alert("Profil kaydedildi âœ”");
}

// Kaydet & BaÅŸlat butonunu baÄŸla
document.getElementById("profileSave").onclick = ()=>saveProfile();

// ACÄ°L akÄ±ÅŸ butonu
document.getElementById("panicBtn").onclick = ()=>{
  if(!LS.getItem("profile")){alert("Ã–nce profil kaydet!");showPanel("profilePanel");return;}
  showPanel("confirmPanel");
  const p=JSON.parse(LS.getItem("profile"));
  document.getElementById("confirm1").innerText = "Acil 1: " + p.acil1.ad;
  document.getElementById("confirm2").innerText = p.acil2?("Acil 2: " + p.acil2.ad):"";
};

// Confirm butonlarÄ±
document.getElementById("confirm112").onclick = ()=>location.href="tel:112";
document.getElementById("confirmCancel").onclick = ()=>hidePanel("confirmPanel");

// Emergency kiÅŸi akÄ±ÅŸÄ±
window.acil = async function(n){
  const p=JSON.parse(LS.getItem("profile"));
  const c = n===1 ? p.acil1 : p.acil2;
  if(!c?.tel) return alert("Acil kiÅŸi yok âŒ");
  location.href="tel:"+c.tel;
  navigator.geolocation?.getCurrentPosition(pos=>{
    const locLink = pos.coords.latitude + "," + pos.coords.longitude;
    const msg=`ğŸš¨ ACÄ°L | ${p.ad}\nKonum: https://maps.google.com/?q=${locLink}`;
    location.href="sms:"+c.tel+"?body="+encodeURIComponent(msg);
    navigator.share?.({title:"Acil",text:msg});
    updateLogUI("ğŸ“¤ "+c.ad+" bilgilendirildi âœ”");
  });
};

window.onload = ()=>{ bindEmergencyButtons(); updateLogUI("Sistem hazÄ±r âœ”"); }
</script>

</body></html>
